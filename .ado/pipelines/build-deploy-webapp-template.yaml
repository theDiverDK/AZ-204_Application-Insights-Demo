parameters:
  - name: webAppName
    type: string

  - name: environment
    type: string
    
  - name: AppServiceName
    type: string
  
  - name: AppType
    type: string
  
  - name: ServiceConnection
    type: string

steps:
  - task: DotNetCoreCLI@2
    displayName: 'Restore Nuget Packages'
    inputs:
      command: 'restore'
      projects: $(System.DefaultWorkingDirectory)/src/WebApps/${{ parameters.webAppName }}/*.csproj
      feedsToUse: 'select'

  - task: DotNetCoreCLI@2
    displayName: 'Build and Publish'
    inputs:
      command: 'publish'
      projects: $(System.DefaultWorkingDirectory)/src/WebApps/${{ parameters.webAppName }}/*.csproj
      publishWebProjects: false
      arguments: "-o $(Build.ArtifactStagingDirectory) --configuration Release"

  - task: PublishPipelineArtifact@1
    displayName: 'Publish artifact'
    inputs:
      targetPath: "$(Build.ArtifactStagingDirectory)"
      artifact: ${{ parameters.AppServiceName }}
      publishLocation: "pipeline"

  - script: |
          echo "webAppName: $(webAppName)"
          echo "environment: $(environment)"
          echo "AppServiceName): $(AppServiceName)"
          echo "azureServiceConnectionName): $(azureServiceConnectionName)"
    displayName: 'Print variables using Bash from build-deploy-webapp-template.yaml'

  - template: deploy-webapp-template.yaml
    parameters:
      webAppName: $(webAppName)
      Environment: $(environment)
      AppServiceName: $(AppServiceName)
      AppType: webApp
      ServiceConnection: $(azureServiceConnectionName)
